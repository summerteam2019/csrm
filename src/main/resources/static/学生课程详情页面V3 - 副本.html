<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>课程讨论</title>
	<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all"/>
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery.min.js"></script>
	<!-- Custom Theme files -->
	<!--theme-style-->
	<link rel="stylesheet" type="text/css" href="css/common.css"/>
	<link rel="stylesheet" type="text/css" href="css/student.css"/>
	<link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
	<!--//theme-style-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="keywords" content="New Store Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design"/>
	<script type="application/x-javascript"> addEventListener("load", function () {
		setTimeout(hideURLbar, 0);
	}, false);

	function hideURLbar() {
		window.scrollTo(0, 1);
	} </script>
	<!-- start menu -->
	<link href="css/memenu.css" rel="stylesheet" type="text/css" media="all"/>
	<script type="text/javascript" src="js/memenu.js"></script>
	<script>$(document).ready(function () {
		//$(".memenu").memenu();
	});</script>

	<script src="js/main.js"></script>
	<script src="js/simpleCart.min.js"></script>

	<link rel="stylesheet" href="css/star.css" media="all" type="text/css"/>
</head>
<body>
<!--header-->
<div id="header">
	<div id="logo">
		<a href="首页（学生首页）.html">慕课网</a>
	</div>

	<div id="login">
		<ul>
			<li>
				<a href="学生中心.html" id="student">个人中心</a>
				<a href="教师中心.html" id="teacher">个人中心</a>
			</li>
			<li>
				<a href="首页（公共首页和游客首页）.html">退出登录</a>
			</li>
		</ul>
	</div>
	<div id="search">
		<input type="text" name="search" placeholder="搜索感兴趣课程" value=""/>
		<button onclick="searchCourse()">搜索</button>
	</div>
</div>

<!--content-->
<!---->
<div class="product">
	<div class="container">
		<div class="col-md-1 product-price"></div>
		<div class="col-md-9 product-price1">
			<div class="col-md-5 single-top">
				<div class="flexslider">
					<ul class="slides">

						<li data-thumb="images/si.png">
							<img src="images/si.png"/>
						</li>
					</ul>
				</div>
				<!-- FlexSlider -->
				<script defer src="js/jquery.flexslider.js"></script>
				<link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen"/>

				<script>
					// Can also be used with $(document).ready()
					$(window).load(function () {
						$('.flexslider').flexslider({
							animation: "slide",
							controlNav: "thumbnails"
						});
					});
				</script>
			</div>
			<div class="col-md-7 single-top-in simpleCart_shelfItem">
				<div class="single-para ">
					<h4 id="kecheng"></h4>
					<div class="star-on">
						<ul class="star-footer">
							<li><a href="#"><i> </i></a></li>
							<li><a href="#"><i> </i></a></li>
							<li><a href="#"><i> </i></a></li>
							<li><a href="#"><i> </i></a></li>
							<li><a href="#"><i> </i></a></li>
						</ul>
						<div class="review">
							<span id="dianji"></span>
							<span>次点击</span>
						</div>
					</div>

					<p id="jieshao"></p>
					<ul class="tag-men">
						<li><span>任课教师:</span>
							<span class="women1" id="jiaoshi"></span></li>
						<li><span>所属院校:</span>
							<span class="women1" id="yuanxiao"></span></li>
					</ul>
					<div id="choose"><a class="add-cart item_add" onclick="chooseCourse()">选 课</a></div>
                    <div id="cancel"><a class="add-cart item_add" onclick="cancelCourse()">撤 课</a></div>
				</div>
			</div>
			<div class="clearfix"></div>
			<div class="cd-tabs">
				<nav>
					<ul class="cd-tabs-navigation">
						<!--<li><a data-content="cinema" href="#0">讨  论 </a></li>-->
						<li><a data-content="television" href="#0" class="selected ">评 分 </a></li>
						<li><a data-content="stuNotice" href="#0">课 程 通 知 </a></li>
						<li><a data-content="download" href="#0">资 源 下 载</a></li>

					</ul>
				</nav>
				<ul class="cd-tabs-content">
					<li data-content="cinema">
						<div class="comments-top-top">
							<div class="top-comment-right-discuss top-comment-right">
								<h6><a calss="top-comment-right-title">第三节课课后问题讨论</a></h6>
								<p class="top-comment-rightp">老师的课，不管是专业性还是组织结构来说，都非常棒！ 老师的授课风格也是严肃中带着些幽默，非常
									亲切！ 可能由于我知识量的欠缺，课程内容对我来说，专业概念稍微偏多，在理解和记忆上还是有一定
									挑战的，如果在概念的讲解上，能添加更多生动详实的案例，或者搭配一些扩充的资料，那就更棒了！ </p>
								<div class="timestamp">
									<h6>赵丽颖 - 发表于2019年6月26日</h6>
									<p><a href="###"
										  onclick="openShutManager(this,'top-comment-right-discuss-contant',false,'点击关闭回复','点击展开回复')">点击展开回复</a>
									</p>
								</div>
							</div>
							<div id="top-comment-right-discuss-contant"
								 class="top-comment-right-discuss-contant collapse">
								<div class="top-comment-right-response top-comment-right">
									<p>老师的课，不管是专业性还是组织结构来说，都非常棒！ 老师的授课风格也是严肃中带着些幽默，非常
										亲切！ 可能由于我知识量的欠缺，课程内容对我来说，专业概念稍微偏多，在理解和记忆上还是有一定
										挑战的，如果在概念的讲解上，能添加更多生动详实的案例，或者搭配一些扩充的资料，那就更棒了！ </p>
									<h6 class="timestamp"> 韩寒 - 发表于2019年6月26日</h6>
								</div>
								<div style="padding: 1em; float:right"></div>

								<div class="top-comment-right-response top-comment-right">
									<p>老师的课，不管是专业性还是组织结构来说，都非常棒！ 老师的授课风格也是严肃中带着些幽默，非常
										亲切！ 可能由于我知识量的欠缺，课程内容对我来说，专业概念稍微偏多，在理解和记忆上还是有一定
										挑战的，如果在概念的讲解上，能添加更多生动详实的案例，或者搭配一些扩充的资料，那就更棒了！ </p>
									<h6 class="timestamp"> 张璐 - 发表于2019年6月26日</h6>
								</div>

								<div class="top-comment-right-response top-comment-right">
									<p><a href="###"
										  onclick="openShutManager(this,'top-comment-right-discuss-reply',false,'我说一句')">我说一句</a>
									</p>
								</div>
								<div id="top-comment-right-discuss-reply"
									 class="top-comment-right-discuss-reply collapse">
									<div class="top-comment-right-response top-comment-right">
										<textarea cols="90" rows="3"></textarea>
										<br>
										<br>
										<button>回复</button>
									</div>
									<div style="padding: 1em; float:right"></div>
								</div>
							</div>
							<div class="clearfix"></div>
						</div>
						<hr/>
						<div class="panel panel-default">
							<div class="panel-heading" style="font-size: 2rem;">发布讨论&nbsp;<span
									style="color:red;"></span>：
							</div>
							<div class="panel-body">
								<h4>主题</h4>
								<input type="text" name="" placeholder="在此处填写主题" value="">
								<br><br>
								<h4>讨论内容</h4>
								<textarea cols="90" rows="3" placeholder="在此处填写内容"></textarea>
								<br>
								<a class="add-re" href="#">发布讨论</a>
							</div>
						</div>
					</li>


					<li data-content="television" class="selected " id="pingfen">
						<div class="comments-top-top">
							<div id="mesContent">

							</div>
							<div class="clearfix"></div>
							<br>
							<hr/>
							<div class="panel panel-default" id="appraise">
								<div class="panel-heading" style="font-size: 2rem;">发表评分&nbsp;<span
										style="color:red;"></span>：
								</div>
								<div class="panel-body">
									<h4>总评</h4>
									<input name="starNum" id="starNum" type="hidden"/>
									<div class="starability-container">
										<fieldset class="starability-slot">
											<input type="radio" id="rate_1_0_1_5" name="starLevel" value="5"/>
											<label for="rate_1_0_1_5" title="5星"></label>
											<input type="radio" id="rate_1_0_1_4" name="starLevel" value="4"/>
											<label for="rate_1_0_1_4" title="4星"></label>
											<input type="radio" id="rate_1_0_1_3" name="starLevel" value="3"/>
											<label for="rate_1_0_1_3" title="3星"></label>
											<input type="radio" id="rate_1_0_1_2" name="starLevel" value="2"/>
											<label for="rate_1_0_1_2" title="2星"></label>
											<input type="radio" id="rate_1_0_1_1" name="starLevel" value="1"/>
											<label for="rate_1_0_1_1" title="1星"></label>
										</fieldset>
									</div>
									<br>
									<br>
									<h4>评价内容</h4>
									<textarea cols="90" rows="3" placeholder="在此处填写内容" id="appraiseContent"></textarea>
									<br>
									<a class="add-re" href="" onclick="submitScore()">发表评分</a>
									<span style="font-size: 2rem;line-height: 2.9rem;padding: 1rem;font-style: oblique;"
										  id="starStr"></span>
								</div>
							</div>
						</div>

					</li>

					<li data-content="stuNotice">
						<div class="comments-top-top" >
							<div id="notice"></div>
							<br><hr/>
						</div>
						<div class="panel panel-default" id="teacherNotice">
							<div class="panel-heading" style="font-size: 2rem;">发布通知&nbsp;<span style="color:red;"></span>：</div>
							<div class="panel-body">
								<br>
								<h4>通知内容</h4>
								<textarea cols="90" rows="3" placeholder="在此处填写内容" id="noticecontent"></textarea>
								<br>
								<a class="add-re" href="" onclick="publishNotice()">发布通知</a>
							</div>
						</div>

					</li>

					<li data-content="download">
						<div class="comments-top-top">
							<div id="resource">
								<div class="top-comment-left">

								</div>
							</div>
							<br>
							<hr/>
							<div id="uploadResource">
							<form id="formUploadFile">
								<input type="file" name="file" id="file"/>
								<input id="resourceName" type="text" placeholder="请输入资源名"/>
								<input type="submit" value="资源上传" onclick="uploadResource();addResource()"/>
							</form>
							</div>
						</div>
					</li>

					<div class="clearfix"></div>
				</ul>
			</div>
		</div>

		<div class="clearfix"></div>
	</div>
</div>

<script src="js/jquerysession.js"></script>
<script src="js/jquery.js"></script>


<script type="text/javascript">

	var urlinfo = window.location.href; //获取当前页面的url
	var len = urlinfo.length;//获取url的长度
	var offset = urlinfo.indexOf("?");//设置参数字符串开始的位置
	var newsidinfo = urlinfo.substr(offset, len)//取出参数字符串 这里会获得类似“id=1”这样的字符串
	var newsids = newsidinfo.split("=");//对获得的参数字符串按照“=”进行分割
	var newsid = newsids[1];//得到参数值
	var newsname = newsids[0];//得到参数名字
	var courseId = newsid;  //课程ID
	//var roleName = $.session.get("ROLE");   //用户角色
	//var userId = $.session.get("ID");  //用户ID
	var userId = 1;
	var roleName = "teacher";

	//判断显示哪些内容
	$(function(){
		if(roleName == "teacher"){
			document.getElementById("appraise").setAttribute("hidden",true);
			document.getElementById("cancel").setAttribute("hidden",true);
			document.getElementById("choose").setAttribute("hidden",true);
			document.getElementById("student").setAttribute("hidden",true);
		}
		else if(roleName == "student"){
			document.getElementById("uploadResource").setAttribute("hidden",true);
			document.getElementById("teacherNotice").setAttribute("hidden",true);
			document.getElementById("teacher").setAttribute("hidden",true);
			$.ajax({
				type: "POST",
				url: "scConnection/ifChoose",//请求程序页面
				dataType: "json",
				data: {
					"userId": userId,
					"courseId": courseId
				},
				success: function (data) {
					if(data){
						document.getElementById("choose").setAttribute("hidden",true);
					}
					else{
						document.getElementById("cancel").setAttribute("hidden",true);
						document.getElementById("appraise").setAttribute("hidden",true);
					}
				}
			});
		}
	});

	//课程显示
	$(function () {
		$.ajax({
			type: "POST",
			url: "course/selectOne",//请求程序页面
			data: {"courseId": courseId},
			success: function (data) {
				$("#kecheng").text(data.courseName);
				$("#dianji").text(data.courseCount);
				$("#jieshao").text(data.courseIntroduce);
				$("#jiaoshi").text(data.teacherName);
				$("#yuanxiao").text(data.collegeName + data.facultyName);
			}

		});
	});

	//选课
	function chooseCourse(){
		$.ajax({
			type: "POST",
			url: "scConnection/addSCConnection",
			dataType: "json",
			data: {
				"userId": userId,
				"courseId": courseId
			},
			success: function(data){
				alert("成功选课！");
				location.replace(location.href);
			}
		});
	}

	//撤课
    function cancelCourse(){
	    $.ajax({
            type: "POST",
            url: "scConnection/deleteSCConnection",
            dataType: "json",
            data: {
                "userId": userId,
                "courseId": courseId
            },
            success: function(data){
                alert("成功撤课！");
				location.replace(location.href);
            }
        });
    }

	//评论显示
	$(function () {
		$.ajax({
			type: "POST",
			url: "/appraise/getAppraiseByCourseId",//请求程序页面
			dataType: "json",
			data: {
				"courseId": courseId
			},
			async: false,
			success: function (data) {
				var str = "";
				var star = new Array();
				for (i = 0; i < data[0].length; i++) {
					star[i] = "<ul class='star-footer'>";
					for (j = 0; j < data[0][i].appraiseGrade; j++) {
						star[i] += "<li><i> </i></li>";
					}
					star[i] += "</ul>";
				}
				for (i = 0; i < data[0].length; i++) {
					str += "<div class=\"top-comment-left\">" +
							"<img class=\"img-responsive\" src=\"images/co.png\" alt=\"\">" +
							"</div>" +
							"<div class=\"top-comment-right top-comment-right-comment\">" +
							"<div><h6><a href=\"#\">" + data[1][i] + "</a></h6>" +
							star[i] +
							"<p class=\"top-comment-rightp\">" + data[0][i].appraiseContent + "</p>" +
							"<h6 class=\"timestamp\">- 发表于" + data[0][i].appraiseTime + "</h6></div>" +
							"<hr>" +
							"</div>";
				}
				$("#mesContent").append(str);
			}
		});

	});

	//发表评分
	function submitScore() {
		var appraiseGrade = $("#starNum").val();
		var appraiseContent = $("#appraiseContent").val();
		var appraiseRaise = 0;
		$.ajax({
			type: "POST",
			url: "/appraise/getAppraiseByUserAndCourse",//请求程序页面
			dataType: "json",
			data: {
				"userId": userId,
				"courseId": courseId
			},
			success: function (data) {
				if (data == null) {
					$.ajax({
						type: "POST",
						url: "/appraise/addAppraise",//请求程序页面
						dataType: "json",
						data: {
							"userId": userId,
							"courseId": courseId,
							"appraiseGrade": appraiseGrade,
							"appraiseContent": appraiseContent,
							"appraiseRaise": appraiseRaise
						},
						success: function (data) {
							location.replace(location.href);
							alert("评论成功！");
						}
					});
				} else {
					alert("你已经评论过了！")
				}
			}
		});
	}

	//显示课程资源
	$(function () {
		$.ajax({
			type: "POST",
			url: "/resource/getResourceByCourseId",//请求程序页面
			dataType: "json",
			data: {
				"courseId": courseId
			},
			success: function (data) {
				var resource = "";
				for (i = 0; i < data.length; i++) {
					resource += "<div class=\"top-comment-left\">" +
							"<a href='http://localhost:8080/resource/files/" + data[i].resourceFilename + "'>" + data[i].resourceName + "</a>" +
							"</div>"
				}
				$("#resource").append(resource);
			}
		});
	});

	//课程搜索
	function searchCourse(){
		var courseKeyWord = $("#searchCourse").val();
		window.location.href = '搜索结果.html?courseKeyWord=' + courseKeyWord;
	}

	//资源上传
	function uploadResource() {
		var formData = new FormData($("#formUploadFile")[0]);
		$.ajax({
			type: "POST",
			url: "/resource/uploadResource",//请求程序页面
			data: formData,
			async: false,
			cache: false,
			contentType: false,
			processData: false,
			success: function (data) {
				window.location.href="http://localhost:8080/教师课程详情页面V2.html?course="+courseId;
				alert(data);
			}
		});
	}
	function addResource() {
		var file = document.getElementById('file');
		var resourceName = $("#resourceName").val();
		var resourceSize = file.files[0].size/1024;
		var resourceFilename = file.files[0].name;
		$.ajax({
			type: "POST",
			url: "/resource/addResource",//请求程序页面
			dataType: "json",
			data: {
				"courseId": courseId,
				"userId": userId,
				"resourceName": resourceName,
				"resourceSize": resourceSize,
				"resourceFilename": resourceFilename,
				"resourceAddress": "http://localhost:8080/resource/files/" + resourceFilename
			},
			success: function (data) {
				window.location.href="http://localhost:8080/教师课程详情页面V2.html?courseId="+courseId;
			}
		});
	}

	//显示课程通知
	$(function(){
		$.ajax({
			type: "POST",
			url: "notice/getNoticeByCourseId",//请求程序页面
			dataType: "json",
			data: {
				"courseId": courseId
			},
			success: function(data){
				var notice = "";
				for(i = 0; i < data.rows.length; i++){
					notice += "<div class=\"top-comment-left\">\n" +
							      "<img class=\"img-responsive\" src=\"images/co.png\" alt=\"\">\n" +
							  "</div>" +
							  "<div class=\"top-comment-right top-comment-right-comment\">" +
							      "<p class=\"top-comment-rightp\">" + data.rows[i].noticeContent + "</p>" +
							      "<h6 class=\"timestamp\"> - 发布于"+data.rows[i].noticeTime+"</h6>" +
							  "</div>\n" +
							  "<div class=\"clearfix\"></div>" +
							  "<br><br>";
				}
				$("#notice").append(notice);
			}
		});
	});

	//发布课程通知
	function publishNotice(){
		var noticeContent = $("#noticecontent").val();
		$.ajax({
			type: "POST",
			url: "notice/insertNotice",//请求程序页面
			dataType: "json",
			data: {
				"courseId": courseId,
				"noticeContent": noticeContent
			},
			success: function(data){
				if(data){
					alert("发布成功！");
				}
				else{
					alert("发布失败！");
				}
			}
		});
	}
</script>

<!--星星评分-->
<script>

	$('[name="starLevel"]').bind("click", function () {
		console.log($(this)[0].value);
		$("#starNum").val($(this)[0].value);
		var starNum = $(this)[0].value;
		/*
		if(starNum == 1) $("#starStr").text("");
		if(starNum == 2) $("#starStr").text("");
		if(starNum == 3) $("#starStr").text("");
		if(starNum == 4) $("#starStr").text("");
		if(starNum == 5) $("#starStr").text("");
		 */
	})
</script>

</body>
</html>




